<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My CRM</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #f5f7fa;
      color: #2d3748;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    header {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    
    h1 {
      color: #1a202c;
      margin-bottom: 10px;
    }
    
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: white;
      padding: 24px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .stat-card h3 {
      font-size: 14px;
      color: #718096;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 8px;
    }
    
    .stat-card .value {
      font-size: 32px;
      font-weight: bold;
      color: #2d3748;
    }
    
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 2px solid #e2e8f0;
    }
    
    .tab {
      padding: 12px 24px;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      font-size: 16px;
      color: #718096;
      transition: all 0.2s;
    }
    
    .tab:hover {
      color: #2d3748;
    }
    
    .tab.active {
      color: #4299e1;
      border-bottom-color: #4299e1;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .card {
      background: white;
      padding: 24px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    
    .card h2 {
      margin-bottom: 20px;
      color: #1a202c;
    }
    
    .form-group {
      margin-bottom: 16px;
    }
    
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      color: #4a5568;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #cbd5e0;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.2s;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #4299e1;
    }
    
    textarea {
      resize: vertical;
      min-height: 80px;
    }
    
    button {
      background: #4299e1;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: background 0.2s;
    }
    
    button:hover {
      background: #3182ce;
    }
    
    .btn-secondary {
      background: #e2e8f0;
      color: #2d3748;
    }
    
    .btn-secondary:hover {
      background: #cbd5e0;
    }
    
    .btn-danger {
      background: #f56565;
    }
    
    .btn-danger:hover {
      background: #e53e3e;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
    }
    
    th {
      text-align: left;
      padding: 12px;
      background: #f7fafc;
      font-weight: 600;
      color: #4a5568;
      border-bottom: 2px solid #e2e8f0;
    }
    
    td {
      padding: 12px;
      border-bottom: 1px solid #e2e8f0;
    }
    
    tr:hover {
      background: #f7fafc;
    }
    
    .actions {
      display: flex;
      gap: 8px;
    }
    
    .actions button {
      padding: 6px 12px;
      font-size: 12px;
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #718096;
    }
    
    .empty-state svg {
      width: 64px;
      height: 64px;
      margin-bottom: 16px;
      opacity: 0.5;
    }
    
    .badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .badge-lead { background: #bee3f8; color: #2c5282; }
    .badge-qualified { background: #c6f6d5; color: #22543d; }
    .badge-proposal { background: #feebc8; color: #7c2d12; }
    .badge-negotiation { background: #fed7d7; color: #742a2a; }
    .badge-closed-won { background: #9ae6b4; color: #22543d; }
    .badge-closed-lost { background: #fc8181; color: #742a2a; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ðŸš€ My CRM</h1>
      <p>Manage your customers, deals, and activities</p>
    </header>

    <div class="stats" id="stats">
      <div class="stat-card">
        <h3>Contacts</h3>
        <div class="value" id="stat-contacts">0</div>
      </div>
      <div class="stat-card">
        <h3>Companies</h3>
        <div class="value" id="stat-companies">0</div>
      </div>
      <div class="stat-card">
        <h3>Active Deals</h3>
        <div class="value" id="stat-deals">0</div>
      </div>
      <div class="stat-card">
        <h3>Pipeline Value</h3>
        <div class="value" id="stat-value">$0</div>
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" onclick="switchTab('contacts')">Contacts</button>
      <button class="tab" onclick="switchTab('companies')">Companies</button>
      <button class="tab" onclick="switchTab('deals')">Deals</button>
    </div>

    <!-- Contacts Tab -->
    <div id="contacts-tab" class="tab-content active">
      <div class="card">
        <h2>Add New Contact</h2>
        <form id="contact-form">
          <div class="form-group">
            <label>First Name *</label>
            <input type="text" id="contact-first-name" required>
          </div>
          <div class="form-group">
            <label>Last Name *</label>
            <input type="text" id="contact-last-name" required>
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="contact-email">
          </div>
          <div class="form-group">
            <label>Phone</label>
            <input type="tel" id="contact-phone">
          </div>
          <div class="form-group">
            <label>Company</label>
            <select id="contact-company"></select>
          </div>
          <button type="submit">Add Contact</button>
        </form>
      </div>

      <div class="card">
        <h2>All Contacts</h2>
        <table id="contacts-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Company</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Companies Tab -->
    <div id="companies-tab" class="tab-content">
      <div class="card">
        <h2>Add New Company</h2>
        <form id="company-form">
          <div class="form-group">
            <label>Company Name *</label>
            <input type="text" id="company-name" required>
          </div>
          <div class="form-group">
            <label>Website</label>
            <input type="url" id="company-website">
          </div>
          <div class="form-group">
            <label>Industry</label>
            <input type="text" id="company-industry">
          </div>
          <button type="submit">Add Company</button>
        </form>
      </div>

      <div class="card">
        <h2>All Companies</h2>
        <table id="companies-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Website</th>
              <th>Industry</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Deals Tab -->
    <div id="deals-tab" class="tab-content">
      <div class="card">
        <h2>Add New Deal</h2>
        <form id="deal-form">
          <div class="form-group">
            <label>Company *</label>
            <select id="deal-company" required></select>
          </div>
          <div class="form-group">
            <label>Deal Title *</label>
            <input type="text" id="deal-title" required>
          </div>
          <div class="form-group">
            <label>Value ($)</label>
            <input type="number" id="deal-value" step="0.01">
          </div>
          <div class="form-group">
            <label>Stage</label>
            <select id="deal-stage">
              <option value="lead">Lead</option>
              <option value="qualified">Qualified</option>
              <option value="proposal">Proposal</option>
              <option value="negotiation">Negotiation</option>
              <option value="closed-won">Closed Won</option>
              <option value="closed-lost">Closed Lost</option>
            </select>
          </div>
          <div class="form-group">
            <label>Expected Close Date</label>
            <input type="date" id="deal-close-date">
          </div>
          <button type="submit">Add Deal</button>
        </form>
      </div>

      <div class="card">
        <h2>All Deals</h2>
        <table id="deals-table">
          <thead>
            <tr>
              <th>Title</th>
              <th>Company</th>
              <th>Value</th>
              <th>Stage</th>
              <th>Close Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = '/api';
    // Tab switching
    function switchTab(tab) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      
      event.target.classList.add('active');
      document.getElementById(`${tab}-tab`).classList.add('active');
    }

    // Load dashboard stats
    async function loadDashboard() {
      try {
        const res = await fetch(`${API_BASE}/dashboard`);
        const data = await res.json();
        
        document.getElementById('stat-contacts').textContent = data.contacts;
        document.getElementById('stat-companies').textContent = data.companies;
        document.getElementById('stat-deals').textContent = data.deals;
        document.getElementById('stat-value').textContent = `$${(data.pipeline_value || 0).toLocaleString()}`;
      } catch (error) {
        console.error('Error loading dashboard:', error);
      }
    }

    // Load companies for dropdowns
    async function loadCompanyDropdowns() {
      try {
        const res = await fetch(`${API_BASE}/companies`);
        const companies = await res.json();
        
        const contactSelect = document.getElementById('contact-company');
        const dealSelect = document.getElementById('deal-company');
        
        contactSelect.innerHTML = '<option value="">None</option>';
        dealSelect.innerHTML = '<option value="">Select a company</option>';
        
        companies.forEach(company => {
          contactSelect.innerHTML += `<option value="${company.id}">${company.name}</option>`;
          dealSelect.innerHTML += `<option value="${company.id}">${company.name}</option>`;
        });
      } catch (error) {
        console.error('Error loading companies:', error);
      }
    }

    // Load and display contacts
    async function loadContacts() {
      try {
        const res = await fetch(`${API_BASE}/contacts`);
        const contacts = await res.json();
        
        const tbody = document.querySelector('#contacts-table tbody');
        tbody.innerHTML = '';
        
        if (contacts.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 40px; color: #718096;">No contacts yet. Add your first contact above!</td></tr>';
          return;
        }
        
        contacts.forEach(contact => {
          tbody.innerHTML += `
            <tr>
              <td>${contact.first_name} ${contact.last_name}</td>
              <td>${contact.email || '-'}</td>
              <td>${contact.phone || '-'}</td>
              <td>${contact.company_name || '-'}</td>
              <td class="actions">
                <button class="btn-danger" onclick="deleteContact(${contact.id})">Delete</button>
              </td>
            </tr>
          `;
        });
      } catch (error) {
        console.error('Error loading contacts:', error);
      }
    }

    // Load and display companies
    async function loadCompanies() {
      try {
        const res = await fetch(`${API_BASE}/companies`);
        const companies = await res.json();
        
        const tbody = document.querySelector('#companies-table tbody');
        tbody.innerHTML = '';
        
        if (companies.length === 0) {
          tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 40px; color: #718096;">No companies yet. Add your first company above!</td></tr>';
          return;
        }
        
        companies.forEach(company => {
          tbody.innerHTML += `
            <tr>
              <td>${company.name}</td>
              <td>${company.website ? `<a href="${company.website}" target="_blank">${company.website}</a>` : '-'}</td>
              <td>${company.industry || '-'}</td>
              <td class="actions">
                <button class="btn-danger" onclick="deleteCompany(${company.id})">Delete</button>
              </td>
            </tr>
          `;
        });
      } catch (error) {
        console.error('Error loading companies:', error);
      }
    }

    // Load and display deals
    async function loadDeals() {
      try {
        const res = await fetch(`${API_BASE}/deals`);
        const deals = await res.json();
        
        const tbody = document.querySelector('#deals-table tbody');
        tbody.innerHTML = '';
        
        if (deals.length === 0) {
          tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: #718096;">No deals yet. Add your first deal above!</td></tr>';
          return;
        }
        
        deals.forEach(deal => {
          tbody.innerHTML += `
            <tr>
              <td>${deal.title}</td>
              <td>${deal.company_name}</td>
              <td>$${(deal.value || 0).toLocaleString()}</td>
              <td><span class="badge badge-${deal.stage}">${deal.stage}</span></td>
              <td>${deal.close_date || '-'}</td>
              <td class="actions">
                <button class="btn-danger" onclick="deleteDeal(${deal.id})">Delete</button>
              </td>
            </tr>
          `;
        });
      } catch (error) {
        console.error('Error loading deals:', error);
      }
    }

    // Form submissions
    document.getElementById('contact-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const data = {
        first_name: document.getElementById('contact-first-name').value,
        last_name: document.getElementById('contact-last-name').value,
        email: document.getElementById('contact-email').value,
        phone: document.getElementById('contact-phone').value,
        company_id: document.getElementById('contact-company').value || null,
      };
      
      try {
        await fetch(`${API_BASE}/contacts`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        e.target.reset();
        loadContacts();
        loadDashboard();
        alert('Contact added successfully!');
      } catch (error) {
        alert('Error adding contact');
        console.error(error);
      }
    });

    document.getElementById('company-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const data = {
        name: document.getElementById('company-name').value,
        website: document.getElementById('company-website').value,
        industry: document.getElementById('company-industry').value,
      };
      
      try {
        await fetch(`${API_BASE}/companies`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        e.target.reset();
        loadCompanies();
        loadCompanyDropdowns();
        loadDashboard();
        alert('Company added successfully!');
      } catch (error) {
        alert('Error adding company');
        console.error(error);
      }
    });

    document.getElementById('deal-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const data = {
        company_id: document.getElementById('deal-company').value,
        title: document.getElementById('deal-title').value,
        value: document.getElementById('deal-value').value,
        stage: document.getElementById('deal-stage').value,
        close_date: document.getElementById('deal-close-date').value,
      };
      
      try {
        await fetch(`${API_BASE}/deals`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        e.target.reset();
        loadDeals();
        loadDashboard();
        alert('Deal added successfully!');
      } catch (error) {
        alert('Error adding deal');
        console.error(error);
      }
    });

    // Delete functions
    async function deleteContact(id) {
      if (!confirm('Are you sure you want to delete this contact?')) return;
      
      try {
        await fetch(`${API_BASE}/contacts/${id}`, { method: 'DELETE' });
        loadContacts();
        loadDashboard();
      } catch (error) {
        alert('Error deleting contact');
        console.error(error);
      }
    }

    async function deleteCompany(id) {
      if (!confirm('Are you sure you want to delete this company?')) return;
      
      try {
        await fetch(`${API_BASE}/companies/${id}`, { method: 'DELETE' });
        loadCompanies();
        loadCompanyDropdowns();
        loadDashboard();
      } catch (error) {
        alert('Error deleting company');
        console.error(error);
      }
    }

    async function deleteDeal(id) {
      if (!confirm('Are you sure you want to delete this deal?')) return;
      
      try {
        await fetch(`${API_BASE}/deals/${id}`, { method: 'DELETE' });
        loadDeals();
        loadDashboard();
      } catch (error) {
        alert('Error deleting deal');
        console.error(error);
      }
    }

    // Initialize
    loadDashboard();
    loadCompanies();
    loadCompanyDropdowns();
    loadContacts();
    loadDeals();
  </script>
</body>
</html>